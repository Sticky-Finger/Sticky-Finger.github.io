---
title: 17 类型检查机制（3）：类型保护
date: 2019-12-01 12:00:34
tags: TypeScript
---
```ts
enum Type { Strong, Weak };

class Java {
    helloJava() {
        console.log('Hello Java');
    }
}

class JavaScript {
    helloJavaScript() {
        console.log('Hello JavaScript');
    }
}

function getLanguage(type: Type) {
    let lang = type === Type.Strong ? new Java() : new JavaScript;
    // if (lang.helloJava) { // 报错，提示lang创建的类型是'Java | JavaScript',此时TS不能推断具体是那种类型，所以需要类型断言
    if ((lang as Java).helloJava) {
        // lang.helloJava();
        (lang as Java).helloJava();
    } else {
        // lang.helloJavaScript();
        (lang as JavaScript).helloJavaScript();
    }
    return lang;
}

getLanguage(Type.String);
```

## 类型保护：
> TypeScript能够在特定的区块中保证变量属于某种确定的类型。可以在此区块中放心地引用此类型的属性，或者调用此类型的方法。

## 四种创建这种特殊区块的方法
- 方法一：instanceof
- 方法二：in
- 方法三：typeof
- 方法四：创建一个类型保护函数
```ts
enum Type { Strong, Weak };

class Java {
    helloJava() {
        console.log('Hello Java');
    }
    
    // 2)
    java: any;
}

class JavaScript {
    helloJavaScript() {
        console.log('Hello JavaScript');
    }
    
    // 2)
    javascript: any;
}

// 4)
function isJava(lang: Java | JavaScript): lang is Java { // 这种返回值叫做，类型谓词
    return (lang as Java).helloJava !== undefined;
}

function getLanguage(type: Type) {
// 3)
function getLanguage(type: Type, x: string | number) {
    // let lang = type === Type.Strong ? new Java() : new JavaScript;
    // // if (lang.helloJava) {
    // if ((lang as Java).helloJava) {
        // // lang.helloJava();
        // (lang as Java).helloJava();
    // } else {
        // // lang.helloJavaScript();
        // (lang as JavaScript).helloJavaScript();
    // }
    
    // 1) instanceof
    if (lang instanceof Java) {
        lang.helloJava();
    } else {
        lang.helloJavaScript();
    }
    
    // 2) in
    if ('java' in lang) {
        lang.helloJava();
    } else {
        lang.helloJavaScript();
    }
    
    // 3) typeof
    if (typeof x === 'string') {
        x.length;
    } else {
        x.toFixed();
    }
    
    // 4) 类型保护函数
    if (isJava(lang)) {
        lang.helloJava();
    } else {
        lang.helloJavaScript();
    }
    
    return lang;
}

getLanguage(Type.String);
```