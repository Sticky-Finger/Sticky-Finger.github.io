---
title: 25 如何编写声明文件
date: 2019-12-01 12:04:06
tags: TypeScript
---
如何在ts中引入外部类库，以及如何为它们编写声明文件

## 示例:
- 1.引入jQuery
  - 安装(类库一般分为3类:全局类库，模块类库，umd类库)

```ts
// index.ts

// 模块化方式引用(全局引入需要webpack配合)
import $ from 'jQuery'; // jQuery是js库，需要声明文件，没有会报错
// 安装 npm i @types/jQuery

$('#app').css('color', 'red')
```

#### 查看类库有没有@types类型声明文件
- typeSearch--查询有没有声明文件
- 贡献声明文件的网站:definitelyTyped

## 三种声明文件写法
- libs文件夹:
  - global-lib.js
  - index.ts
  - module-lib.js
  - umd-lib.js

### 1.全局库
```js
// global-lib.js

function globalLib(options) {
    console.log(options);
}
globalLib.version = '1.0.0';

globalLib.doSomething = function() {
    console.log('globalLib do somethimg');
}
```

使用这个全局库:
- 在index.html用script标签将其引入进来
- 在index.ts中引入
```ts
globalLib({x: 1}); // 没有同名.d.ts时,报错
```

- 引入global-lib.d.ts到同一目录下
```ts
// global-lib.d.ts

// 
decalre function globalLib(options: globalLib.Options): void;

declare namespace globalLib {
    // version和doSomething命名空间成员，在命名空间与函数合并时，会变成函数的成员
    const version: string;
    function doSomething(): void;
    // 这个接口也可以在全局定义，不过这样做接口就被全局暴露出来了
    interface Options {
        [key: string]: any;
    }
}
```

### 2.模块类库
```js
// module-lib.js
const version = '1.0.0';

function doSomething() {
    console.log('moduleLib do something');
}

function moduleLib(options) {
    console.log(options);
}

moduleLib.version = version;
moduleLib.doSomething = doSomething;

module.exports = moduleLib;
```

- index.ts引入:
```ts
import moduleLib from './module-lib';
```
- 同目录下引入同名.d.ts
```ts
// module-lib.d.ts

declare function moduleLib(options: Options): void;

interface Options {
    [key: string]: any
}

declare namespace moduleLib {
    const version: string
    // export const version: string // ts官网写法，实际效果和上面一样
    function doSomething(): void
}

export = moduleLib
```

### 3.umd类库
```js
// umd-lib.js

(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        define(factory);
    } else if (typeof module === 'object' && module.exports) {
        module.exports = factory();
    } else {
        root.umdLib = factory();
    }
})(this, function() {
    return {
        version: '1.0.0',
        doSomething() {
            console.log('umdLib do something');
        },
    };
})
```

- 使用引入到index.ts
```ts
import umdLib from './umd-lib'
umdLib.doSomething()
```

- 同名声明文件
```ts
// umd-lib.d.ts

declare namespace umdLib {
    const version: string
    function doSomething(): void
}

// 转为
export as namespace umdLib

export = umdLib
```
