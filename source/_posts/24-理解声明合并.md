---
title: 24 理解声明合并
date: 2019-12-01 12:03:29
tags: TypeScript
---
声明合并指:编译器会把程序多个地方具有相同名称的声明合并为一个声明

这样的好处--可以把程序中散落在各处的重名声明，合并在一起

通过声明合并就可以避免对接口成员的遗漏

<!-- more -->

## 接口的声明合并
```ts
interface A {
    x: number;
    // y: string; // 编译器报错
}
interface A {
    y: number;
}

let a: A = { // a中要有A接口的所有成员
    x: 1,
    y: 1,
};
```

- 如果上述接口定义在全局环境中，两个接口不用定义在一个文件中就可以发生合并

- 对于接口中非函数类型的成员，要求保证它的唯一性。如果不唯一，则类型必须相同
- 对于函数类型成员，每一个函数都会被声明为一个函数重载

```ts
interface A {
    x: number;
    foo (bar: number): number; // 5
    foo (bar: 'a'): number; // 2
}
interface A {
    y: number;
    foo (bar: string): string; // 3
    foo (bar: number[]): number[]; // 4
    foo (bar: 'b'): number; // 1
}

let a: A = {
    x: 1,
    y: 1,
    foo(bar: any) {
        return bar;
    },
};
```

> 函数重载时，要注意函数声明的顺序，因为编译器是按照函数声明的顺序匹配的

函数成员声明重载合并顺序:
- 1.同一个接口内，按书写顺序合并
- 2.接口之间，后面的接口排在前面
- 3.[!]()例外:当一个函数声明的自变量为**字符串字面量**时，重载顺序会排在最前面


---

## 命名空间的声明合并
- ### 1.命名空间之间的合并--注意:命名空间导出的成员是不可以重复定义的

- ### 命名空间和函数的合并
```ts
function Lib() {}
namespace Lib {
    export let version = '1.0';
}

console.log(Lib.version);
```
相当于给一个函数增加了个属性

- #### 命名空间和类进行声明合并
```ts
class C {}
namespace C {
    export let state = 1;
}

console.log(C.state);
```
相当于给类添加了一些静态属性

- #### 命名空间和枚举进行合并
```ts
enum Color {
    Red,
    Yellow,
    Blue,
}
namespace Color {
    export function mix() {}
}

console.log(Color.mix)
```
这样相当于给这个枚举类型增加了个方法

> #### 注意:函数、类和命名空间进行声明合并，命名空间一定要放在后面

  - 枚举和命名空间合并,位置关系没有这个问题
  -  思考:为什么?

## 小结
> 在我们程序中如果有多处重名的声明，不是一个好的模式，最好还是封装在一个模块之内